{"code":"import { __extends } from \"tslib\";\r\nimport classNames from 'classnames';\r\nimport PropTypes from 'prop-types';\r\nimport React from 'react';\r\nimport { Image, View } from '@tarojs/components';\r\nimport Taro from '@tarojs/taro';\r\nimport { uuid } from '../../common/utils';\r\n// 生成 jsx 二维矩阵\r\nvar generateMatrix = function (files, col, showAddBtn) {\r\n    var matrix = [];\r\n    var length = showAddBtn ? files.length + 1 : files.length;\r\n    var row = Math.ceil(length / col);\r\n    for (var i = 0; i < row; i++) {\r\n        if (i === row - 1) {\r\n            // 最后一行数据加上添加按钮\r\n            var lastArr = files.slice(i * col);\r\n            if (lastArr.length < col) {\r\n                if (showAddBtn) {\r\n                    lastArr.push({ type: 'btn', uuid: uuid() });\r\n                }\r\n                // 填补剩下的空列\r\n                for (var j = lastArr.length; j < col; j++) {\r\n                    lastArr.push({ type: 'blank', uuid: uuid() });\r\n                }\r\n            }\r\n            matrix.push(lastArr);\r\n        }\r\n        else {\r\n            matrix.push(files.slice(i * col, (i + 1) * col));\r\n        }\r\n    }\r\n    return matrix;\r\n};\r\nvar ENV = Taro.getEnv();\r\nvar AtImagePicker = /** @class */ (function (_super) {\r\n    __extends(AtImagePicker, _super);\r\n    function AtImagePicker() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.chooseFile = function () {\r\n            var _a = _this.props, _b = _a.files, files = _b === void 0 ? [] : _b, multiple = _a.multiple, count = _a.count, sizeType = _a.sizeType, sourceType = _a.sourceType;\r\n            var filePathName = ENV === Taro.ENV_TYPE.ALIPAY ? 'apFilePaths' : 'tempFiles';\r\n            // const count = multiple ? 99 : 1\r\n            var params = {};\r\n            if (multiple) {\r\n                params.count = 99;\r\n            }\r\n            if (count) {\r\n                params.count = count;\r\n            }\r\n            if (sizeType) {\r\n                params.sizeType = sizeType;\r\n            }\r\n            if (sourceType) {\r\n                params.sourceType = sourceType;\r\n            }\r\n            Taro.chooseImage(params)\r\n                .then(function (res) {\r\n                var targetFiles = res.tempFilePaths.map(function (path, i) { return ({\r\n                    url: path,\r\n                    file: res[filePathName][i]\r\n                }); });\r\n                var newFiles = files.concat(targetFiles);\r\n                _this.props.onChange(newFiles, 'add');\r\n            })\r\n                .catch(function (err) {\r\n                var _a, _b;\r\n                (_b = (_a = _this.props) === null || _a === void 0 ? void 0 : _a.onFail) === null || _b === void 0 ? void 0 : _b.call(_a, err);\r\n            });\r\n        };\r\n        _this.handleImageClick = function (idx) {\r\n            _this.props.onImageClick &&\r\n                _this.props.onImageClick(idx, _this.props.files[idx]);\r\n        };\r\n        _this.handleRemoveImg = function (idx, event) {\r\n            event.stopPropagation();\r\n            event.preventDefault();\r\n            var _a = _this.props.files, files = _a === void 0 ? [] : _a;\r\n            if (ENV === Taro.ENV_TYPE.WEB) {\r\n                window.URL.revokeObjectURL(files[idx].url);\r\n            }\r\n            var newFiles = files.filter(function (_, i) { return i !== idx; });\r\n            _this.props.onChange(newFiles, 'remove', idx);\r\n        };\r\n        return _this;\r\n    }\r\n    AtImagePicker.prototype.render = function () {\r\n        var _this = this;\r\n        var _a = this.props, className = _a.className, customStyle = _a.customStyle, files = _a.files, mode = _a.mode, _b = _a.length, length = _b === void 0 ? 4 : _b, _c = _a.showAddBtn, showAddBtn = _c === void 0 ? true : _c;\r\n        var rowLength = length <= 0 ? 1 : length;\r\n        // 行数\r\n        var matrix = generateMatrix(files, rowLength, showAddBtn);\r\n        var rootCls = classNames('at-image-picker', className);\r\n        return (React.createElement(View, { className: rootCls, style: customStyle }, matrix.map(function (row, i) { return (React.createElement(View, { className: 'at-image-picker__flex-box', key: i + 1 }, row.map(function (item, j) {\r\n            return item.url ? (React.createElement(View, { className: 'at-image-picker__flex-item', key: i * length + j },\r\n                React.createElement(View, { className: 'at-image-picker__item' },\r\n                    React.createElement(View, { className: 'at-image-picker__remove-btn', onClick: _this.handleRemoveImg.bind(_this, i * length + j) }),\r\n                    React.createElement(Image, { className: 'at-image-picker__preview-img', mode: mode, src: item.url, onClick: _this.handleImageClick.bind(_this, i * length + j) })))) : (React.createElement(View, { className: 'at-image-picker__flex-item', key: \"empty_\".concat(i * length).concat(j) }, item.type === 'btn' && (React.createElement(View, { onClick: _this.chooseFile }, _this.props.children\r\n                || React.createElement(View, { className: 'at-image-picker__item at-image-picker__choose-btn' },\r\n                    React.createElement(View, { className: 'add-bar' }),\r\n                    React.createElement(View, { className: 'add-bar' }))))));\r\n        }))); })));\r\n    };\r\n    return AtImagePicker;\r\n}(React.Component));\r\nexport default AtImagePicker;\r\nAtImagePicker.defaultProps = {\r\n    className: '',\r\n    customStyle: '',\r\n    files: [],\r\n    mode: 'aspectFill',\r\n    showAddBtn: true,\r\n    multiple: false,\r\n    length: 4,\r\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n    onChange: function () { }\r\n};\r\nAtImagePicker.propTypes = {\r\n    className: PropTypes.oneOfType([PropTypes.string, PropTypes.array]),\r\n    customStyle: PropTypes.oneOfType([PropTypes.string, PropTypes.object]),\r\n    files: PropTypes.array,\r\n    mode: PropTypes.oneOf([\r\n        'scaleToFill',\r\n        'aspectFit',\r\n        'aspectFill',\r\n        'widthFix',\r\n        'top',\r\n        'bottom',\r\n        'center',\r\n        'left',\r\n        'right',\r\n        'top left',\r\n        'top right',\r\n        'bottom left',\r\n        'bottom right'\r\n    ]),\r\n    showAddBtn: PropTypes.bool,\r\n    multiple: PropTypes.bool,\r\n    length: PropTypes.number,\r\n    onChange: PropTypes.func,\r\n    onImageClick: PropTypes.func,\r\n    onFail: PropTypes.func,\r\n    count: PropTypes.number,\r\n    sizeType: PropTypes.array,\r\n    sourceType: PropTypes.array\r\n};\r\n//# sourceMappingURL=index.js.map","references":["/Users/leejunhui/Develop/React/Library/taro-ui/node_modules/.pnpm/@types+classnames@2.2.10/node_modules/@types/classnames/index.d.ts","/Users/leejunhui/Develop/React/Library/taro-ui/node_modules/.pnpm/prop-types@15.7.2/node_modules/prop-types/index.js","/Users/leejunhui/Develop/React/Library/taro-ui/node_modules/.pnpm/@types+react@18.2.21/node_modules/@types/react/ts5.0/index.d.ts","/Users/leejunhui/Develop/React/Library/taro-ui/node_modules/.pnpm/@tarojs+components@3.6.6_@types+react-native@0.64.13_@types+react@18.2.21_react@18.2.0/node_modules/@tarojs/components/types/index.d.ts","/Users/leejunhui/Develop/React/Library/taro-ui/node_modules/.pnpm/@tarojs+components@3.6.6_@types+react-native@0.64.13_@types+react@18.2.21_react@18.2.0/node_modules/@tarojs/components/types/common.d.ts","/Users/leejunhui/Develop/React/Library/taro-ui/node_modules/.pnpm/@tarojs+taro@3.6.6_@types+react@18.2.21/node_modules/@tarojs/taro/types/index.d.ts","/Users/leejunhui/Develop/React/Library/taro-ui/packages/taro-ui/types/image-picker.d.ts","/Users/leejunhui/Develop/React/Library/taro-ui/packages/taro-ui/src/common/utils.ts"],"map":"{\"version\":3,\"file\":\"index.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/components/image-picker/index.tsx\"],\"names\":[],\"mappings\":\"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\"}"}
