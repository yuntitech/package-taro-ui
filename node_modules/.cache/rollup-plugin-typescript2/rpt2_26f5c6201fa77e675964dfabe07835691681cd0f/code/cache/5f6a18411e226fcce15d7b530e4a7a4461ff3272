{"code":"import { __awaiter, __extends, __generator } from \"tslib\";\r\nimport classNames from 'classnames';\r\nimport PropTypes from 'prop-types';\r\nimport React from 'react';\r\nimport Taro from '@tarojs/taro';\r\nimport { Text, View, MovableArea, MovableView } from '@tarojs/components';\r\nimport { uuid, delayGetClientRect } from '../../common/utils';\r\nimport AtSwipeActionOptions from './options/index';\r\nvar AtSwipeAction = /** @class */ (function (_super) {\r\n    __extends(AtSwipeAction, _super);\r\n    function AtSwipeAction(props) {\r\n        var _this = _super.call(this, props) || this;\r\n        _this.handleOpened = function (event) {\r\n            var onOpened = _this.props.onOpened;\r\n            if (typeof onOpened === 'function') {\r\n                onOpened(event);\r\n            }\r\n        };\r\n        _this.handleClosed = function (event) {\r\n            var onClosed = _this.props.onClosed;\r\n            if (typeof onClosed === 'function') {\r\n                onClosed(event);\r\n            }\r\n        };\r\n        _this.handleClick = function (item, index, event) {\r\n            var _a = _this.props, onClick = _a.onClick, autoClose = _a.autoClose;\r\n            if (typeof onClick === 'function') {\r\n                onClick(item, index, event);\r\n            }\r\n            if (autoClose) {\r\n                _this._reset(false); // TODO: Check behavior\r\n                _this.handleClosed(event);\r\n            }\r\n        };\r\n        _this.onTouchEnd = function (e) {\r\n            var maxOffsetSize = _this.state.maxOffsetSize;\r\n            if (Math.abs(_this.moveX) < maxOffsetSize / 2) {\r\n                _this._reset(false);\r\n                _this.handleClosed(e);\r\n            }\r\n            else {\r\n                _this._reset(true);\r\n                _this.handleOpened(e);\r\n            }\r\n        };\r\n        _this.onChange = function (e) {\r\n            _this.moveX = e.detail.x;\r\n        };\r\n        var isOpened = props.isOpened;\r\n        _this.state = {\r\n            componentId: uuid(),\r\n            // eslint-disable-next-line no-extra-boolean-cast\r\n            offsetSize: 0,\r\n            _isOpened: !!isOpened,\r\n            needAnimation: false,\r\n            eleWidth: 0,\r\n            maxOffsetSize: 0\r\n        };\r\n        _this.moveX = _this.state.offsetSize;\r\n        return _this;\r\n    }\r\n    AtSwipeAction.prototype.componentDidMount = function () {\r\n        this.getAreaWidth();\r\n    };\r\n    // 当 eleWidth 发生变化时，需要重新计算 maxOffsetSize\r\n    AtSwipeAction.prototype.componentDidUpdate = function (_, prevState) {\r\n        var eleWidth = this.state.eleWidth;\r\n        if (prevState.eleWidth !== eleWidth) {\r\n            this.getMaxOffsetSize();\r\n        }\r\n    };\r\n    AtSwipeAction.prototype.UNSAFE_componentWillReceiveProps = function (nextProps) {\r\n        var isOpened = nextProps.isOpened;\r\n        var _a = this.state, _isOpened = _a._isOpened, maxOffsetSize = _a.maxOffsetSize;\r\n        if (isOpened !== _isOpened) {\r\n            this.moveX = isOpened ? 0 : maxOffsetSize;\r\n            this._reset(!!isOpened); // TODO: Check behavior\r\n        }\r\n    };\r\n    /**\r\n     * 获取滑动区域宽度\r\n     */\r\n    AtSwipeAction.prototype.getAreaWidth = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var systemInfo;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, Taro.getSystemInfo()];\r\n                    case 1:\r\n                        systemInfo = _a.sent();\r\n                        this.setState({\r\n                            eleWidth: systemInfo.windowWidth\r\n                        });\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * 获取最大偏移量\r\n     */\r\n    AtSwipeAction.prototype.getMaxOffsetSize = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var componentId, actionOptionsRect, maxOffsetSize;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        componentId = this.state.componentId;\r\n                        return [4 /*yield*/, delayGetClientRect({\r\n                                selectorStr: \"#swipeActionOptions-\".concat(componentId)\r\n                            })];\r\n                    case 1:\r\n                        actionOptionsRect = _a.sent();\r\n                        maxOffsetSize = actionOptionsRect[0].width;\r\n                        this.setState({\r\n                            maxOffsetSize: maxOffsetSize\r\n                        });\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    AtSwipeAction.prototype._reset = function (isOpened) {\r\n        var _this = this;\r\n        if (isOpened) {\r\n            var maxOffsetSize = this.state.maxOffsetSize;\r\n            if (process.env.TARO_ENV === 'jd') {\r\n                this.setState({\r\n                    _isOpened: true,\r\n                    offsetSize: -maxOffsetSize + 0.01\r\n                });\r\n            }\r\n            else {\r\n                this.setState({\r\n                    _isOpened: true,\r\n                    offsetSize: -maxOffsetSize\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            this.setState({\r\n                offsetSize: this.moveX\r\n            }, function () {\r\n                _this.setState({\r\n                    offsetSize: 0,\r\n                    _isOpened: false\r\n                });\r\n            });\r\n        }\r\n    };\r\n    AtSwipeAction.prototype.render = function () {\r\n        var _this = this;\r\n        var _a = this.state, componentId = _a.componentId, maxOffsetSize = _a.maxOffsetSize, eleWidth = _a.eleWidth, offsetSize = _a.offsetSize;\r\n        var _b = this.props, options = _b.options, disabled = _b.disabled;\r\n        var rootClass = classNames('at-swipe-action', this.props.className);\r\n        return (React.createElement(View, { id: \"swipeAction-\".concat(componentId), className: rootClass, style: {\r\n                width: \"\".concat(eleWidth, \"px\")\r\n            } },\r\n            React.createElement(MovableArea, { className: 'at-swipe-action__area', style: {\r\n                    width: \"\".concat(eleWidth, \"px\")\r\n                } },\r\n                React.createElement(MovableView, { className: 'at-swipe-action__content', direction: 'horizontal', damping: 50, x: offsetSize, onTouchEnd: this.onTouchEnd, onChange: this.onChange, disabled: disabled, style: {\r\n                        width: \"\".concat(eleWidth + maxOffsetSize, \"px\")\r\n                    } },\r\n                    this.props.children,\r\n                    Array.isArray(options) && options.length > 0 ? (React.createElement(AtSwipeActionOptions, { options: options, componentId: componentId, customStyle: {\r\n                            opacity: maxOffsetSize ? 1 : 0\r\n                        } }, options.map(function (item, key) { return (React.createElement(View, { key: \"\".concat(item.text, \"-\").concat(key), style: item.style, onClick: function (e) { return _this.handleClick(item, key, e); }, className: classNames('at-swipe-action__option', item.className) },\r\n                        React.createElement(Text, { className: 'option__text' }, item.text))); }))) : null))));\r\n    };\r\n    return AtSwipeAction;\r\n}(React.Component));\r\nexport default AtSwipeAction;\r\nAtSwipeAction.defaultProps = {\r\n    options: [],\r\n    isOpened: false,\r\n    disabled: false,\r\n    autoClose: false,\r\n    maxDistance: 0,\r\n    areaWidth: 0\r\n};\r\nAtSwipeAction.propTypes = {\r\n    isOpened: PropTypes.bool,\r\n    disabled: PropTypes.bool,\r\n    autoClose: PropTypes.bool,\r\n    options: PropTypes.arrayOf(PropTypes.shape({\r\n        text: PropTypes.string,\r\n        style: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\r\n        className: PropTypes.oneOfType([\r\n            PropTypes.object,\r\n            PropTypes.string,\r\n            PropTypes.array\r\n        ])\r\n    })),\r\n    onClick: PropTypes.func,\r\n    onOpened: PropTypes.func,\r\n    onClosed: PropTypes.func\r\n};\r\n//# sourceMappingURL=index.js.map","references":["/Users/leejunhui/Develop/React/Library/taro-ui/node_modules/.pnpm/@types+classnames@2.2.10/node_modules/@types/classnames/index.d.ts","/Users/leejunhui/Develop/React/Library/taro-ui/node_modules/.pnpm/prop-types@15.7.2/node_modules/prop-types/index.js","/Users/leejunhui/Develop/React/Library/taro-ui/node_modules/.pnpm/@types+react@18.2.21/node_modules/@types/react/ts5.0/index.d.ts","/Users/leejunhui/Develop/React/Library/taro-ui/node_modules/.pnpm/@tarojs+taro@3.6.6_@types+react@18.2.21/node_modules/@tarojs/taro/types/index.d.ts","/Users/leejunhui/Develop/React/Library/taro-ui/node_modules/.pnpm/@tarojs+components@3.6.6_@types+react-native@0.64.13_@types+react@18.2.21_react@18.2.0/node_modules/@tarojs/components/types/index.d.ts","/Users/leejunhui/Develop/React/Library/taro-ui/node_modules/.pnpm/@tarojs+components@3.6.6_@types+react-native@0.64.13_@types+react@18.2.21_react@18.2.0/node_modules/@tarojs/components/types/common.d.ts","/Users/leejunhui/Develop/React/Library/taro-ui/packages/taro-ui/types/swipe-action.d.ts","/Users/leejunhui/Develop/React/Library/taro-ui/packages/taro-ui/src/common/utils.ts","/Users/leejunhui/Develop/React/Library/taro-ui/packages/taro-ui/src/components/swipe-action/options/index.tsx"],"map":"{\"version\":3,\"file\":\"index.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/components/swipe-action/index.tsx\"],\"names\":[],\"mappings\":\"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\"}"}
